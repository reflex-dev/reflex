name: Publish to PyPI

on:
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    environment:
      name: pypi
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Install uv
        uses: astral-sh/setup-uv@v7

      - name: Build
        run: uv build

      - name: Verify .pyi files in wheel
        run: |
          if unzip -l dist/*.whl | grep '\.pyi$'; then
            echo "âœ“ .pyi files found in distribution"
          else
            echo "Error: No .pyi files found in wheel"
            exit 1
          fi

      - name: Publish
        run: uv publish
